# 问题二
根据当日互动情况预测5位用户的关注情况，实际关注数，及关注的博主
## 目前采用的方法：

对提供的attachment文件进行每日互动情况统计，结构为

|User ID|Blogger ID|Date|浏览|点赞|评论|label|
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|U1|B10|2024-07-22|1|1|0|0|
|U1|B15|2024-07-22|1|1|0|0|
|U1|B17|2024-07-22|1|1|0|0|

历史数据和0722当日的数据分别进行存储`data\0722_activity_used_to_train.csv`和`data\day_activity_used_to_train.csv`

### 为避免训练时数据泄露
为避免训练时数据泄露，将原本`groupby`时对应的关注去除，新增`label`列用作模型训练的target

### 模型训练时
模型训练时对应的`user_id`,`blogger_id`作为文本类无法传入模型，
将训练集和测试集合并后统一`encode`然后新增`user_id_enc`,`blogger_id_enc`列作为训练的特征。
### 采用`lightGBM`,`XGBoost`模型进行预测
由于样本分布不均匀，其中百万条均是未关注数据，导致传统分类模型直接全部预测为`0`,
加入`scale_pos_weight=scale_pos_weight`训练分布不均匀目标
结果如下

### 训练集评估报告：
所采用的模型
`XGBoost`

```python
model = xgb.XGBClassifier(
    objective='binary:logistic',
    n_estimators=500,
    max_depth=8,
    learning_rate=0.01,
    scale_pos_weight=scale_pos_weight,  # 处理类别不平衡
    eval_metric='logloss',
    random_state=42
)
```

||precision|recall|f1-score|support|
|:--|:--:|:--:|:--:|:--:|
|0|0.9793|0.6957|0.8135|860648|
|1|0.1499|0.7848|0.2518|58864|
|accuracy|||0.7014|919512|
|macro avg|0.5646|0.7402|0.5326|919512|
|weighted avg|0.9262|0.7014|0.7775|919512|

## 选择能够处理非均匀分布的概率问题
查看数据分布
！[数据分布图](./pic/data_distribute.png)


### 选择上采样后效果仍没有提升，调整思路

### 选择仅针对目标用户进行预测

筛选目标用户行为数据`U7`,`U6749`,`U5769`,`U14990`,`U52010`大大减少无效样本数量
通过用户-博主两侧进行建模

针对目标用户获取历史互动数据，获取用户已关注博主列表，获取用户在0722当日行为数据，找出未关注但有大量互动博主

在博主侧，对潜在博主进行特征建模，获取博主和其他用户的互动情况及关注转化比

然后进行预测看看效果

#### 用户已关注列表
|User ID|Blogger IDs|
|--|--|
|U14990|['B13']|
|U52010|['B2' 'B23' 'B3' 'B72']|
|U5769|['B13' 'B19' 'B22' 'B9']|
|U6749|['B44']|
|U7|['B12' 'B13' 'B2' 'B4' 'B6' 'B8']|

修改方法后，能够准确预测

#### 训练集评估报告

=== 训练集评估报告 ===
||precision|    recall|  f1-score|   support|
|--|--|--|--|--|
|0|     1.0000|    0.9816|    0.9907|       217|
|1     |0.8000|    1.0000|    0.8889|        16|
| accuracy||| 0.9828|233|
|macro avg |    0.9000|    0.9908|    0.9398|       233|
|weighted avg    | 0.9863|    0.9828|    0.9837|       233|

效果不错ROC和PR曲线均达到了1
